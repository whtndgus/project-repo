<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>의사 - 계정 관리</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="assets/img/newlogo.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet" />

    <!-- Template Main CSS File -->
    <link href="../assets/css/style.css" rel="stylesheet" />

    <!-- =======================================================
  * Template Name: NiceAdmin
  * Updated: Mar 09 2023 with Bootstrap v5.2.3
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
    <style>
      .card-body {
        padding: var(--bs-card-spacer-y) var(--bs-card-spacer-x);
      }

      /* 
      #profile-preview {
        min-width: 180px;
        min-height: 218px;
      }

      #profile-detail {
        margin-left: 3rem;
        min-height: 218px;
      } */
    </style>
  </head>

  <body>
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top d-flex align-items-center">
      <div class="d-flex align-items-center justify-content-between">
        <a class="logo d-flex align-items-center">
          <img src="../register/assets/img/headerlogo-d.png">
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
      </div>
      <!-- End Logo -->
      <div class="top-menu">
        <a href="hospitals-list.html" class="nav-link collapsed"
          ><span>병원</span></a
        >

        <a href="doctors-community-main.html" class="nav-link collapsed"
          ><span>커뮤니티</span></a
        >
      </div>
      <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
          <li class="nav-item dropdown pe-3">
            <a
              class="nav-link nav-profile d-flex align-items-center pe-0"
              href="doctors-profile.html"
            >
              <div id="pre-userimg"></div>
              <span id="username" class="d-none d-md-block ps-2"></span>
            </a>
          </li>
        </ul>
      </nav>
    </header>

    <!-- ======= Sidebar ======= -->
    <aside id="sidebar" class="sidebar">
      <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-heading">의사 전용 페이지</li>

        <li class="nav-item">
          <a class="nav-link" href="doctors-profile.html">
            <i class="bi bi-person"></i>
            <span>내 정보</span>
          </a>
        </li>
        <!-- End Profile Page Nav -->

        <li class="nav-item">
          <a class="nav-link collapsed" href="doctors-advices.html">
            <i class="bi bi-file-earmark"></i>
            <span>진료하기</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="QnQ-doc.html">
            <i class="bi bi-question-circle"></i>
            <span>문의하기</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="hospitals-view.html">
            <i class="bi bi-card-list"></i>
            <span>내 병원 정보</span>
          </a>
        </li>
        <!-- End Register Page Nav -->

        <!-- 로그아웃 태그 -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <li class="nav-item logout">
          <a class="nav-link collapsed">
            <i class="bi bi-box-arrow-in-right"></i>
            <span>로그아웃</span>
          </a>
        </li>
        <!-- End Login Page Nav -->
        <script>
          $(".logout").click(() => {
            console.log(11);
            fetch(`http://175.106.99.31/auth/logout`, {
              method: "GET",
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status == "success") {
                  location.href = "";
                } else {
                  alert("로그아웃 실패");
                  location.href = "";
                }
              });
          });
        </script>
      </ul>
      <img
        src="../register/assets/img/mainlogo.png"
        style="height: 150px; margin-top: 400px; margin-left: 40px"
      />
    </aside>
    <!-- End Sidebar-->

    <main id="main" class="main">
      <div class="pagetitle">
        <h1>내 정보</h1>
      </div>
      <!-- End Page Title -->

      <section class="section profile">
        <div class="row">
          <div class="col-xl-6">
            <div class="card">
              <div class="card-body pt-3">
                <div class="pt-4 pb-2">
                  <h5 class="card-title text-center pb-0 fs-4">계정 관리</h5>
                  <p class="text-center small">
                    회원님의 정보 보호를 위하여 다시 한 번 로그인해 주시기
                    바랍니다.
                  </p>
                </div>
                <form
                  id="check-password-form"
                  class="needs-validation"
                  novalidate
                >
                  <div
                    class="row mb-3 d-flex align-items-center justify-content-center"
                  >
                    <label
                      for="password"
                      class="col-sm-2 form-label padding-right-0"
                      >비밀번호</label
                    >
                    <div class="col-sm-5">
                      <input
                        type="password"
                        name="password"
                        id="password"
                        class="form-control"
                        required
                      />
                      <div
                        id="password-validation-msg"
                        class="validation-msg"
                      ></div>
                    </div>
                    <div class="col-sm-2">
                      <button
                        type="button"
                        id="check-password-btn"
                        class="btn btn-outline-secondary"
                      >
                        확인
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <!-- End #main -->

    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div>
        <div class="tooltip-container">
          <a
            href="https://github.com/whtmdgus"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="조승현"
          >
            <img src="../register/assets/img/gitlogo.png" style="width: 40px" />
          </a>
          <a
            href="https://github.com/chaminju927"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="차민주"
          >
            <img src="../register/assets/img/gitlogo.png" style="width: 40px" />
          </a>
          <a
            href="https://github.com/molang2"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="이준영"
          >
            <img src="../register/assets/img/gitlogo.png" style="width: 40px" />
          </a>
          <a
            href="https://github.com/hyunwookimkim"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="김현우"
          >
            <img src="../register/assets/img/gitlogo.png" style="width: 40px" />
          </a>
          <a
            href="https://github.com/omelase"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="이예찬"
          >
            <img src="../register/assets/img/gitlogo.png" style="width: 40px" />
          </a>
        </div>
        <div class="footer-img-container">
          <img src="../register/assets/img/bitcamplogo.png" />
          <img
            src="../register/assets/img/navercloudlogo.png"
            style="width: 200px; margin-left: 50px"
          />
          <img
            src="../register/assets/img/magicecole.png"
            style="width: 150px; margin-left: 50px"
          />
        </div>
      </div>
    </footer>
    <!-- End Footer -->

    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/chart.js/chart.umd.js"></script>
    <script src="assets/vendor/echarts/echarts.min.js"></script>
    <script src="assets/vendor/quill/quill.min.js"></script>
    <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>

    <!-- 사용자가 추가한 스크립트 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
      let profileId;
      fetch(`http://175.106.99.31/auth/user`, {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.status == "success") {
            //사용자 이름
            document.querySelector("#username").innerHTML = data.data.name;
            //사용자 이미지
            const preImageContainer = document.querySelector("#pre-userimg");
            let phoUrl = "";
            if (data.data.phoUrl != "undefined") {
              phoUrl =
                "http://uyaxhfqyqnwh16694929.cdn.ntruss.com/member-img/" +
                data.data.phoUrl +
                "?type=f&w=36&h=36&quality=100&anilimit=24";
            } else {
              phoUrl = "../assets/img/default_profile.png";
            }
            const phoType = data.data.phoType;
            const phoName = data.data.phoName;

            // 새로운 이미지 요소 생성 및 추가
            const newImg = document.createElement("img");
            newImg.setAttribute("id", "userimg");
            newImg.setAttribute("src", phoUrl);
            newImg.setAttribute("alt", phoName);
            newImg.setAttribute("style", "width:36px; border-radius:50%");
            preImageContainer.appendChild(newImg);
            return data.data;
          } else {
            location.href = "../auth/doctors-login.html";
          }
        })
        .then((user) => {
          if (user.hosName !== undefined) {
          } else {
            console.log(user.hosName);
            location.href = "../auth/doctors-login.html";
          }
          profileId = user.id;
        });

      const passwordInput = document.getElementById("password");
      const passwordValidationMsg = document.getElementById(
        "password-validation-msg"
      );
      const checkPasswordBtn = document.getElementById("check-password-btn");

      checkPasswordBtn.addEventListener("click", () => {
        // $("#btn-insert").prop('disabled', true);
        const form = document.getElementById("check-password-form");
        const formData = new FormData(form);

        const password = passwordInput.value;

        formData.append("id", profileId);

        let json = JSON.stringify(Object.fromEntries(formData));
        console.log(json);

        fetch("http://175.106.99.31/doctors/check-mypage", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: json,
        })
          .then((response) => response.json())
          .then((result) => {
            if (result.status == "success") {
              console.log(result);
              console.log(result.data);
              // passwordValidationMsg.textContent = '올바른 비밀번호입니다.';
              // passwordInput.classList.remove('is-valid', 'is-invalid');
              // passwordInput.classList.add('is-valid');
              // passwordValidationMsg.style.color = '#198754';
              location.replace("./doctors-profile.html");
            } else {
              passwordValidationMsg.textContent = "비밀번호가 틀립니다.";
              passwordInput.classList.remove("is-valid", "is-invalid");
              passwordInput.classList.add("is-invalid");
              passwordValidationMsg.style.color = "#dc3545";
            }
          })
          .then(() => {})
          .catch((exception) => {
            console.error("오류 발생:", exception);
            passwordValidationMsg.textContent =
              "오류가 발생했습니다. 다시 시도해주세요.";
            passwordInput.classList.remove("is-valid", "is-invalid");
            passwordInput.classList.add("is-invalid");
            passwordValidationMsg.style.color = "#dc3545";
          });
      });
      document.addEventListener(
        "keydown",
        function (event) {
          if (event.keyCode === 13) {
            event.preventDefault();
            console.log(11);
            // $("#btn-insert").prop('disabled', true);
            const form = document.getElementById("check-password-form");
            const formData = new FormData(form);

            const password = passwordInput.value;

            formData.append("id", profileId);

            let json = JSON.stringify(Object.fromEntries(formData));
            console.log(json);

            fetch("http://175.106.99.31/doctors/check-mypage", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: json,
            })
              .then((response) => response.json())
              .then((result) => {
                if (result.status == "success") {
                  console.log(result);
                  console.log(result.data);
                  // passwordValidationMsg.textContent = '올바른 비밀번호입니다.';
                  // passwordInput.classList.remove('is-valid', 'is-invalid');
                  // passwordInput.classList.add('is-valid');
                  // passwordValidationMsg.style.color = '#198754';
                  location.replace("./doctors-profile.html");
                } else {
                  passwordValidationMsg.textContent = "비밀번호가 틀립니다.";
                  passwordInput.classList.remove("is-valid", "is-invalid");
                  passwordInput.classList.add("is-invalid");
                  passwordValidationMsg.style.color = "#dc3545";
                }
              })
              .then(() => {})
              .catch((exception) => {
                console.error("오류 발생:", exception);
                passwordValidationMsg.textContent =
                  "오류가 발생했습니다. 다시 시도해주세요.";
                passwordInput.classList.remove("is-valid", "is-invalid");
                passwordInput.classList.add("is-invalid");
                passwordValidationMsg.style.color = "#dc3545";
              });
          }
        },
        true
      );
    </script>
  </body>
</html>
